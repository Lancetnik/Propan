# Найстройки и Переменные Окружения

В большинстве случаев вашему приложению необходимы внешние настройки или конфигурация, например, данные для подключения к брокеру сообщений или базе данных.

Для этих целей обычно используют переменные окружения, которые затем потребляются вашим приложением и используются для настройки.

## Pydantic `Settings`

К счастью, **Pydantic** предоставляет возможность захватывать переменный окружения и использовать их для настроек [Pydantic: Settings management](https://docs.pydantic.dev/latest/usage/pydantic_settings/){.external-link target="_blank"}.

### Install `pydantic-settings`

Для начала установите `pydantic-settings`:

<div class="termy">
```console
$ pip install pydantic-settings
---> 100%
```
</div>

!!! info
    В **Pydantic v1** эти настройки включены в состав основного пакета. Но сейчас они поставляются как отдельный пакет, так что вы можете выбрать, нужна вам эта функиональность или нет.

### Создайте объект `Settings`

Импортируйте `BaseSettings` из Pydantic и создайте его наследника, также как вы это делаете для Pydantic BaseModel.

Точно также вы можете объявить атрибуты класса с их аннотацией и значениями по умолчанию.

Вы можете использовать те же самые преимущества и инструмента для валидации, что и для Pydantic моделей, например, валидация с помощью `Field()`.

=== "*Pydantic* v2"
    ```python linenums='1' hl_lines="1 3" title="config.py"
    {!> docs_src/quickstart/settings/settings_base_2.py !}
    ```

=== "Pydantic v1"
    !!! info
        В **Pydantic v1** вы можете импортировать `BaseSettings` прямо из `pydantic` вместо `pydantic_settings`.

    ```python linenums='1' hl_lines="1 3" title="config.py"
    {!> docs_src/quickstart/settings/settings_base_1.py !}
    ```

Затем, создайте объект класса `Settings`, Pydantic прочитает переменные окружения (регистронезависимо), так что, переменные вроде `APP_NAME` будут распознаны как поле `app_name` вашего класса.

Затем Pydantic провалидирует полученные значения, поэтому ваши строковые значения из переменных окружения будут приведены к указанному в аннотации `Settins` типу.

### Используйте `settings`

Теперь вы можете использовать объект `settings` в вашем приложении:

```python linenums='1' hl_lines="4 6 9" title="serve.py"
{!> docs_src/quickstart/settings/usage.py !}
```

### Запустите приложения

Теперь вы можете запустить ваше приложение с указанием переменных окружения, например `URL`:

<div class="termy">
```console
$ URL="amqp://guest:guest@localhost:5672" propan run serve:app
```
</div>

!!! tip
    Для установки нескольких переменных окружения для одной просто разделите их пробелом и поместите перед самой командой.

## Чтение `.env` файла

Если у вас есть множество настроек, которые необходимо изменять, или просто несколько наборов окружений, может быть полезно объединить все переменные и прочитать их из одного файла.

Эта практика достаточно распространена: все переменные окружения помещаются в файл `.env`, который принято называть "dotenv".

!!! tip
    Файлы, начинающиеся с точки (`.`) являются скрытыми в Unix системах, например Linux и macOS.

    Но "dotenv" не обязательно должен иметь такое имя.

Pydantic имеет поддержку чтения настроек из таких файлов через установку внешней зависимости **python-dotenv**. Мы можете прочитать об этом больше в документации [Pydantic Settings: Dotenv (.env) support](https://docs.pydantic.dev/latest/usage/pydantic_settings/#dotenv-env-support){.external-link target="_blank"}.

!!! tip
    Для того, чтобы это работало, установите `pip install python-dotenv`.

### Файл `.env`

Представим файл `.env` следующего содержания:

```bash
URL="amqp://guest:guest@localhost:5672"
QUEUE="test-queue"
```

### Читаем данные из `.env`

Обновите ваш `config.py` следующим образом:

```python linenums='1' hl_lines="1 7"
{!> docs_src/quickstart/settings/settings_env.py !}
```

Так вы сможете указывать, какой именно `.env` файл использовать прямо из вашего терминала. Это может быть очень полезно при тестировании или развертывании приложения на продакшене.

!!! note
    В нашем случае Pydantic пытается найти `.env` файл по умолчанию, но ошибки не возникнет, если такого файла нет. Pydantic просто использует значения ваших полей по умолчанию.

### Вабор `.env` file at start

Теперь вы можете выбирать различные файлы настроек прямо при запуске вашего приложения:

<div class="termy">
```console
$ ENV=.local.env propan run serve:app
```
</div>

Или, например, настройки для продакшена

<div class="termy">
```console
$ ENV=.production.env propan run serve:app
```
</div>

Или даже тестовое окружение

<div class="termy">
```console
$ ENV=.test.env pytest
```
</div
