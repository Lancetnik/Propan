# Direct

**Direct** Subject - базовый способ маршрутизации сообщений в *NATS*. Его суть очень проста:
`subject` отправляет сообщения всем потребителям, подписанным на него.

## Масштабирование

Если один `subject` слушает несколько потребителей с одинаковой `queue group`, сообщение будет уходить каждый раз случайному потребителю.

Таким образом, *NATS* может самостоятельно балансировать нагрузку на потребителей очереди. Вы можете увеличить скорость обработки потока сообщений из очереди просто запустив дополнительные инстансы сервиса-потребителя. Вам не нужно вносить изменений в текущую конфигурацию инфраструктуры: *NATS* сам позаботится о том, как распределить сообщения между вашими сервисами.

## Пример

**Direct** Subject - тип, используемый в **Propan** по умолчанию: вы можете просто объявить его следующим образом

```python
@broker.handler("test_subject")
async def handler():
    ...
```

Полный пример:

```python linenums="1"
{!> docs_src/nats/direct.py !}
```

### Объявление потребителей

Для начала мы объявили несколько потребителей для двух `subject`: `test-subj-1` и `test-subj-2`:

```python linenums="7" hl_lines="1 5 9"
{!> docs_src/nats/direct.py [ln:7-17]!}
```

!!! note
    Обратите внимание, что все потребители подписаны с использованием одной `queue_group`: в рамках одного сервиса это не имеет смысла, так как сообщения будут приходить в эти обработчики поочередно.
    Здесь мы эмулируем работу несколько потребителей и балансировку нагрузки между ними.

### Распределение сообщений

Теперь распределение сообщений между этими потребителями будет выглядеть следующим образом:

```python
{!> docs_src/nats/direct.py [ln:21]!}
```

Сообщение `1` будет отправлено в `handler1` или `handler2`, т.к. они слушают один `subject` в рамках одной `queue group`

---

```python
{!> docs_src/nats/direct.py [ln:22]!}
```

Сообщение `2` будет отправлено аналогично сообщению `1`

---

```python
{!> docs_src/nats/direct.py [ln:23]!}
```

Сообщение `3` будет отправлено в `handler3`, т.к. он единственный слушает `test-subj-2`